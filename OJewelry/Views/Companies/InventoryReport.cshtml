@model OJewelry.Models.InventoryReportModel

@{
    ViewBag.Title = "Inventory Report";
}

<h2>Inventory Report for the <i>@Model.CompanyName</i> Company</h2>

<br />

@Html.ActionLink("Export Inventory Report", "ExportInventoryReport",
    new { CompanyId = Model.CompanyId, currDate = DateTime.Now.ToLocalTime().ToString("d") }, new { id = "ExportLink", onclick = "GetDate(" + @Model.CompanyId + ")" }) |

@Html.ActionLink("Inventory", "Inventory", new { CompanyId = Model.CompanyId }) |
@Html.ActionLink("Companies", "Index")

<br /><br />

<table class="table">
    <tr>
        <th>Style</th>
        <th>Name</th>
        <th>Description</th>
        <th>Jewelry Type</th>
        <th>Collection</th>
        <th>Retail</th>
        <!--Loop thru Memo locations-->
        @foreach (OJewelry.Models.irmLocation l in Model.locations)
        {
            <th>@l.ShortName</th>
        }
    </tr>

    @foreach (OJewelry.Models.irmStyle s in Model.styles)
    {
    <tr>
        <td>@s.StyleNum</td>
        <td>@s.StyleName</td>
        <td>@s.StyleDesc</td>
        <td>@s.JewelryTypeName</td>
        <td>@s.StyleCollectionName</td>
        <td>@s.StylePrice</td>
        @foreach (OJewelry.Models.irmLocation l in Model.locations)
        {

            OJewelry.Models.irmLS cell = Model.locationQuantsbystyle.Where(x => x.StyleId == s.StyleId && x.PresenterId == l.PresenterId).SingleOrDefault();
            string qty = "-";
            if (cell != null)
            {
                qty = cell.MemoQty.ToString();
            }
        <td>@qty</td>
        }
    </tr>
        <tr></tr>
    }

</table>

@Html.ActionLink("Export Inventory Report", "ExportInventoryReport",
    new { CompanyId = Model.CompanyId, currDate = DateTime.Now.ToLocalTime().ToString("d") }, new { id = "ExportLink", onclick = "GetDate(" + @Model.CompanyId + ")" }) |

@Html.ActionLink("Inventory", "Inventory", new { CompanyId = Model.CompanyId }) |
@Html.ActionLink("Companies", "Index")


@section Scripts {
    <script>
        function GetDate(compId) {
            var dmd = new Date().toLocaleDateString() + " " + new Date().toLocaleTimeString();
            var dt = new Date(dmd);
            var mo = dt.getMonth() + 1; var day = dt.getDate(); var yr = dt.getFullYear();
            var hr = dt.getHours(); var mn = dt.getMinutes();
            var mr = hr < 12 ? "AM" : "PM";
            if (hr > 12) { hr -= 12; } if (hr == 0) { hr += 12; }
            var dts = mo + "-" + day + "-" + yr + " " + hr + "_" + mn + " " + mr;
            var s = '/Companies/ExportInventoryReport?CompanyId=' + compId + '&currDate=' + dts;
            console.log($("#ExportLink").attr("href"));
            console.log(s);
            $("#ExportLink").attr("href", s);
            console.log($("#ExportLink").attr("href"));
            return true;
        }
    </script>
}